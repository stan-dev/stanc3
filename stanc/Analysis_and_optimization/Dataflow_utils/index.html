<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dataflow_utils (stanc.Analysis_and_optimization.Dataflow_utils)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">stanc</a> &#x00BB; <a href="../index.html">Analysis_and_optimization</a> &#x00BB; Dataflow_utils</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Analysis_and_optimization.Dataflow_utils</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-union_maps_left"><a href="#val-union_maps_left" class="anchor"></a><code><span><span class="keyword">val</span> union_maps_left : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <span class="xref-unresolved">Core</span>.Map.Poly.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <span class="xref-unresolved">Core</span>.Map.Poly.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <span class="xref-unresolved">Core</span>.Map.Poly.t</span></span></code></div><div class="spec-doc"><p>Union maps, preserving the left element in a collision</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-build_cf_graphs"><a href="#val-build_cf_graphs" class="anchor"></a><code><span><span class="keyword">val</span> build_cf_graphs : 
  <span><span class="optlabel">?flatten_loops</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?blocks_after_body</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>,
    <span><span>(<a href="../../Middle/Expr/Typed/index.html#type-t">Middle.Expr.Typed.t</a>, <a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>)</span> <a href="../../Middle/Stmt/Pattern/index.html#type-t">Middle.Stmt.Pattern.t</a></span> * <span class="type-var">'m</span>)</span>
    <span class="xref-unresolved">Core</span>.Map.Poly.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a> <span class="xref-unresolved">Core</span>.Set.Poly.t</span>
  * <span><span>(<a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>, <span><a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a> <span class="xref-unresolved">Core</span>.Set.Poly.t</span>)</span>
      <span class="xref-unresolved">Core</span>.Map.Poly.t</span>
  * <span><span>(<a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>, <span><a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a> <span class="xref-unresolved">Core</span>.Set.Poly.t</span>)</span>
      <span class="xref-unresolved">Core</span>.Map.Poly.t</span></span></code></div><div class="spec-doc"><p>Simultaneously builds the controlflow parent graph, the predecessor graph and the exit set of a statement. It's advantageous to build them together because they both rely on some of the same Break, Continue and Return bookkeeping.</p><p>Takes a statement map and returns the triple: (exit set, predecessor graph, controlflow parent graph) where</p><ul><li>(exit set, predecessor graph) is the return value of build_predecessor_graph</li><li>(controlflow parent graph) is the return value of build_cf_graph</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-build_cf_graph"><a href="#val-build_cf_graph" class="anchor"></a><code><span><span class="keyword">val</span> build_cf_graph : 
  <span><span><span>(<a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>,
    <span><span>(<a href="../../Middle/Expr/Typed/index.html#type-t">Middle.Expr.Typed.t</a>, <a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>)</span> <a href="../../Middle/Stmt/Pattern/index.html#type-t">Middle.Stmt.Pattern.t</a></span> * <span class="type-var">'m</span>)</span>
    <span class="xref-unresolved">Core</span>.Map.Poly.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>, <span><a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a> <span class="xref-unresolved">Core</span>.Set.Poly.t</span>)</span> <span class="xref-unresolved">Core</span>.Map.Poly.t</span></span></code></div><div class="spec-doc"><p>Building the controlflow graph requires a traversal with state that includes continues, breaks, returns and the controlflow graph accumulator. The traversal should be a branching traversal with set unions rather than a forward traversal because continue and return statements shouldn't affect other branches of execution.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-build_predecessor_graph"><a href="#val-build_predecessor_graph" class="anchor"></a><code><span><span class="keyword">val</span> build_predecessor_graph : 
  <span><span class="optlabel">?flatten_loops</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?blocks_after_body</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>,
    <span><span>(<a href="../../Middle/Expr/Typed/index.html#type-t">Middle.Expr.Typed.t</a>, <a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>)</span> <a href="../../Middle/Stmt/Pattern/index.html#type-t">Middle.Stmt.Pattern.t</a></span> * <span class="type-var">'m</span>)</span>
    <span class="xref-unresolved">Core</span>.Map.Poly.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a> <span class="xref-unresolved">Core</span>.Set.Poly.t</span>
  * <span><span>(<a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>, <span><a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a> <span class="xref-unresolved">Core</span>.Set.Poly.t</span>)</span>
      <span class="xref-unresolved">Core</span>.Map.Poly.t</span></span></code></div><div class="spec-doc"><p>Building the predecessor graph requires a traversal with state that includes the current previous nodes and the predecessor graph accumulator. Special cases are made for loops, because they should include the body exits as predecessors to the body, and they should include loop predecessors in their exit sets. I'm not sure if the single re-traversal of the loop body is sufficient or this requires finding a fixed-point.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-build_recursive_statement"><a href="#val-build_recursive_statement" class="anchor"></a><code><span><span class="keyword">val</span> build_recursive_statement : 
  <span><span>(<span><span><span>(<span class="type-var">'e</span>, <span class="type-var">'s</span>)</span> <a href="../../Middle/Stmt/Pattern/index.html#type-t">Middle.Stmt.Pattern.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'s</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>, <span><span>(<span class="type-var">'e</span>, <a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>)</span> <a href="../../Middle/Stmt/Pattern/index.html#type-t">Middle.Stmt.Pattern.t</a></span> * <span class="type-var">'m</span>)</span>
    <span class="xref-unresolved">Core</span>.Map.Poly.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'s</span></span></code></div><div class="spec-doc"><p>Build a fixed-point data type representation of a statement given a label-map representation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_ctrl_flow"><a href="#val-is_ctrl_flow" class="anchor"></a><code><span><span class="keyword">val</span> is_ctrl_flow : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../../Middle/Stmt/Pattern/index.html#type-t">Middle.Stmt.Pattern.t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check if the statement controls the execution of its substatements.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge_set_maps"><a href="#val-merge_set_maps" class="anchor"></a><code><span><span class="keyword">val</span> merge_set_maps : 
  <span><span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'b</span> <span class="xref-unresolved">Core</span>.Set.Poly.t</span>)</span> <span class="xref-unresolved">Core</span>.Map.Poly.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'b</span> <span class="xref-unresolved">Core</span>.Set.Poly.t</span>)</span> <span class="xref-unresolved">Core</span>.Map.Poly.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'b</span> <span class="xref-unresolved">Core</span>.Set.Poly.t</span>)</span> <span class="xref-unresolved">Core</span>.Map.Poly.t</span></span></code></div><div class="spec-doc"><p>Merge two maps whose values are sets, and union the sets when there's a collision.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-build_statement_map"><a href="#val-build_statement_map" class="anchor"></a><code><span><span class="keyword">val</span> build_statement_map : 
  <span><span>(<span><span class="type-var">'s</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'e</span>, <span class="type-var">'s</span>)</span> <a href="../../Middle/Stmt/Pattern/index.html#type-t">Middle.Stmt.Pattern.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'s</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'s</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>, <span><span>(<span class="type-var">'e</span>, <a href="../Dataflow_types/index.html#type-label">Dataflow_types.label</a>)</span> <a href="../../Middle/Stmt/Pattern/index.html#type-t">Middle.Stmt.Pattern.t</a></span> * <span class="type-var">'m</span>)</span>
    <span class="xref-unresolved">Core</span>.Map.Poly.t</span></span></code></div><div class="spec-doc"><p>The statement map is built by traversing substatements recursively to replace substatements with their labels while building up the substatements' statement maps. Then, the result is the union of the substatement maps with this statement's singleton pair, which is expressed in terms of the new label-containing statement.</p></div></div></div></body></html>
