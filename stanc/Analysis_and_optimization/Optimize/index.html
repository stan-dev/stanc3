<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Optimize (stanc.Analysis_and_optimization.Optimize)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">stanc</a> &#x00BB; <a href="../index.html">Analysis_and_optimization</a> &#x00BB; Optimize</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Analysis_and_optimization.Optimize</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-function_inlining"><a href="#val-function_inlining" class="anchor"></a><code><span><span class="keyword">val</span> function_inlining : <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Inline all functions except for ones with forward declarations (e.g. recursive functions, mutually recursive functions, and functions without a definition</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-static_loop_unrolling"><a href="#val-static_loop_unrolling" class="anchor"></a><code><span><span class="keyword">val</span> static_loop_unrolling : <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Unroll all for-loops with constant bounds, as long as they do not contain break or continue statements in their body at the top level</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-one_step_loop_unrolling"><a href="#val-one_step_loop_unrolling" class="anchor"></a><code><span><span class="keyword">val</span> one_step_loop_unrolling : <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Unroll all loops for one iteration, as long as they do not contain break or continue statements in their body at the top level</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list_collapsing"><a href="#val-list_collapsing" class="anchor"></a><code><span><span class="keyword">val</span> list_collapsing : <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Remove redundant SList constructors from the Mir that might have been introduced by other optimizations</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-block_fixing"><a href="#val-block_fixing" class="anchor"></a><code><span><span class="keyword">val</span> block_fixing : <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Make sure that SList constructors directly under if, for, while or fundef constructors are replaced with Block constructors. This should probably be run before we generate code.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-constant_propagation"><a href="#val-constant_propagation" class="anchor"></a><code><span><span class="keyword">val</span> constant_propagation : 
  <span><span class="optlabel">?preserve_stability</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Propagate constant values through variable assignments</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expression_propagation"><a href="#val-expression_propagation" class="anchor"></a><code><span><span class="keyword">val</span> expression_propagation : 
  <span><span class="optlabel">?preserve_stability</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Propagate arbitrary expressions through variable assignments. This can be useful for opening up new possibilities for partial evaluation. It should be followed by some CSE or lazy code motion pass, however.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy_propagation"><a href="#val-copy_propagation" class="anchor"></a><code><span><span class="keyword">val</span> copy_propagation : <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Propagate copies of variables through assignments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dead_code_elimination"><a href="#val-dead_code_elimination" class="anchor"></a><code><span><span class="keyword">val</span> dead_code_elimination : <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Eliminate semantically redundant code branches. This includes removing redundant assignments (because they will be overwritten) and removing redundant code in program branches that will never be reached.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-partial_evaluation"><a href="#val-partial_evaluation" class="anchor"></a><code><span><span class="keyword">val</span> partial_evaluation : <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Partially evaluate expressions in the program. This includes simplification using algebraic identities of logical and arithmetic operators as well as Stan math functions.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lazy_code_motion"><a href="#val-lazy_code_motion" class="anchor"></a><code><span><span class="keyword">val</span> lazy_code_motion : 
  <span><span class="optlabel">?preserve_stability</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Perform partial redundancy elmination using the lazy code motion algorithm. This subsumes common subexpression elimination and loop-invariant code motion.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-optimize_ad_levels"><a href="#val-optimize_ad_levels" class="anchor"></a><code><span><span class="keyword">val</span> optimize_ad_levels : <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Assign the optimal ad-levels to local variables. That means, make sure that variables only ever get treated as autodiff variables if they have some dependency on a parameter</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-allow_uninitialized_decls"><a href="#val-allow_uninitialized_decls" class="anchor"></a><code><span><span class="keyword">val</span> allow_uninitialized_decls : 
  <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Marks Decl types such that, if the first assignment after the decl assigns to the full object, allow the object to be constructed but not uninitialized.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-optimization_settings"><a href="#type-optimization_settings" class="anchor"></a><code><span><span class="keyword">type</span> optimization_settings</span><span> = </span><span>{</span></code><ol><li id="type-optimization_settings.function_inlining" class="def record field anchored"><a href="#type-optimization_settings.function_inlining" class="anchor"></a><code><span>function_inlining : bool;</span></code></li><li id="type-optimization_settings.static_loop_unrolling" class="def record field anchored"><a href="#type-optimization_settings.static_loop_unrolling" class="anchor"></a><code><span>static_loop_unrolling : bool;</span></code></li><li id="type-optimization_settings.one_step_loop_unrolling" class="def record field anchored"><a href="#type-optimization_settings.one_step_loop_unrolling" class="anchor"></a><code><span>one_step_loop_unrolling : bool;</span></code></li><li id="type-optimization_settings.list_collapsing" class="def record field anchored"><a href="#type-optimization_settings.list_collapsing" class="anchor"></a><code><span>list_collapsing : bool;</span></code></li><li id="type-optimization_settings.block_fixing" class="def record field anchored"><a href="#type-optimization_settings.block_fixing" class="anchor"></a><code><span>block_fixing : bool;</span></code></li><li id="type-optimization_settings.allow_uninitialized_decls" class="def record field anchored"><a href="#type-optimization_settings.allow_uninitialized_decls" class="anchor"></a><code><span>allow_uninitialized_decls : bool;</span></code></li><li id="type-optimization_settings.constant_propagation" class="def record field anchored"><a href="#type-optimization_settings.constant_propagation" class="anchor"></a><code><span>constant_propagation : bool;</span></code></li><li id="type-optimization_settings.expression_propagation" class="def record field anchored"><a href="#type-optimization_settings.expression_propagation" class="anchor"></a><code><span>expression_propagation : bool;</span></code></li><li id="type-optimization_settings.copy_propagation" class="def record field anchored"><a href="#type-optimization_settings.copy_propagation" class="anchor"></a><code><span>copy_propagation : bool;</span></code></li><li id="type-optimization_settings.dead_code_elimination" class="def record field anchored"><a href="#type-optimization_settings.dead_code_elimination" class="anchor"></a><code><span>dead_code_elimination : bool;</span></code></li><li id="type-optimization_settings.partial_evaluation" class="def record field anchored"><a href="#type-optimization_settings.partial_evaluation" class="anchor"></a><code><span>partial_evaluation : bool;</span></code></li><li id="type-optimization_settings.lazy_code_motion" class="def record field anchored"><a href="#type-optimization_settings.lazy_code_motion" class="anchor"></a><code><span>lazy_code_motion : bool;</span></code></li><li id="type-optimization_settings.optimize_ad_levels" class="def record field anchored"><a href="#type-optimization_settings.optimize_ad_levels" class="anchor"></a><code><span>optimize_ad_levels : bool;</span></code></li><li id="type-optimization_settings.preserve_stability" class="def record field anchored"><a href="#type-optimization_settings.preserve_stability" class="anchor"></a><code><span>preserve_stability : bool;</span></code></li><li id="type-optimization_settings.optimize_soa" class="def record field anchored"><a href="#type-optimization_settings.optimize_soa" class="anchor"></a><code><span>optimize_soa : bool;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Interface for turning individual optimizations on/off. Useful for testing and for top-level interface flags.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-all_optimizations"><a href="#val-all_optimizations" class="anchor"></a><code><span><span class="keyword">val</span> all_optimizations : <a href="#type-optimization_settings">optimization_settings</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-no_optimizations"><a href="#val-no_optimizations" class="anchor"></a><code><span><span class="keyword">val</span> no_optimizations : <a href="#type-optimization_settings">optimization_settings</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-optimization_level"><a href="#type-optimization_level" class="anchor"></a><code><span><span class="keyword">type</span> optimization_level</span><span> = </span></code><ol><li id="type-optimization_level.O0" class="def variant constructor anchored"><a href="#type-optimization_level.O0" class="anchor"></a><code><span>| </span><span><span class="constructor">O0</span></span></code></li><li id="type-optimization_level.O1" class="def variant constructor anchored"><a href="#type-optimization_level.O1" class="anchor"></a><code><span>| </span><span><span class="constructor">O1</span></span></code></li><li id="type-optimization_level.Oexperimental" class="def variant constructor anchored"><a href="#type-optimization_level.Oexperimental" class="anchor"></a><code><span>| </span><span><span class="constructor">Oexperimental</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-level_optimizations"><a href="#val-level_optimizations" class="anchor"></a><code><span><span class="keyword">val</span> level_optimizations : <span><a href="#type-optimization_level">optimization_level</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-optimization_settings">optimization_settings</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-optimization_suite"><a href="#val-optimization_suite" class="anchor"></a><code><span><span class="keyword">val</span> optimization_suite : 
  <span><span class="optlabel">?settings</span>:<a href="#type-optimization_settings">optimization_settings</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../Middle/Program/Typed/index.html#type-t">Middle.Program.Typed.t</a></span></code></div><div class="spec-doc"><p>Perform all optimizations in this module on the MIR in an appropriate order.</p></div></div></div></body></html>
